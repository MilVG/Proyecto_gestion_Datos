CREATE DATABASE EDUCANDOSA
GO
USE EDUCANDOSA
GO

CREATE TABLE USUARIOS(
 ID INT IDENTITY PRIMARY KEY NOT NULL,
 NOMBRE VARCHAR(60) NOT NULL,
 ROL VARCHAR(20) NULL,
 CEDULA CHAR(10) NOT NULL
)
GO
CREATE TABLE SOLICITUDES(
  ID INT IDENTITY PRIMARY KEY NOT NULL,  
  IDRESPONSBLE INT NOT NULL,
  FECHA DATETIME DEFAULT GETDATE() NOT NULL,
  CENTRO_COSTOS VARCHAR(30) NOT NULL,
  RUBRO_PRESUPUESTAL VARCHAR(30) NOT NULL
)
GO


CREATE TABLE ITEMS(
  ID INT IDENTITY PRIMARY KEY NOT NULL,
  NOMBREBIEN VARCHAR(60) NOT NULL,
  CANTIDAD FLOAT NOT NULL,
  VALOR_UNIDAD FLOAT NOT NULL,
  VALORTOTAL FLOAT NOT NULL,
  UNIDAD_MEDIDA VARCHAR(30) NOT NULL,
  IDSOLICITUD INT NOT NULL,
  IDFACTURA INT NOT NULL
)
GO


CREATE TABLE ORDER_CONTRACTUAL(
 ID INT IDENTITY PRIMARY KEY NOT NULL,
 NOM_PROVEEDOR VARCHAR(60) NOT NULL,
 FECHA_ORDEN DATETIME DEFAULT GETDATE() NOT NULL,
 MONTO_TOTAL FLOAT NOT NULL,
 FECHA_ENTREGA DATETIME NOT NULL,
 RUC VARCHAR(30) NOT NULL
)
GO

CREATE TABLE INVENTARIO(
 ID INT IDENTITY PRIMARY KEY NOT NULL,
 IDRESPOSABLE INT NOT NULL,
 FECHAENTREGA DATETIME NOT NULL,
 DIRECCION VARCHAR(100) NOT NULL,
 IDCOMPRA INT NOT NULL
 )
 GO
 CREATE TABLE SALIDA_ALMACEN(
  ID INT IDENTITY PRIMARY KEY NOT NULL,
  EMPLEADO VARCHAR(60) NOT NULL,
  FECHASALIDA DATETIME NOT NULL,
  FECHAENTREGA DATETIME NOT NULL,
  IDFACTURA INT NOT NULL
 )
 GO


 CREATE TABLE COMPRA(
  ID INT IDENTITY PRIMARY KEY NOT NULL,
  IDSOLICITUD INT NOT NULL,
  IDORDENCONTRACTUAL INT NOT NULL,
  IDINVENTARIO INT NOT NULL
 )
 GO
 
CREATE TABLE FACTURA(
 ID INT IDENTITY PRIMARY KEY NOT NULL,
 IDITEM INT NOT NULL,
 IDORDENCONTRACTUAL INT NOT NULL,
 TOTAL_BIENES INT NOT NULL,
 FECHA DATETIME NOT NULL,
 PROVEEDOR VARCHAR(60) NOT NULL,
 VALORTOTAL FLOAT NOT NULL
)
GO
ALTER TABLE FACTURA ADD FOREIGN KEY (IDITEM) REFERENCES ITEMS
ALTER TABLE FACTURA ADD FOREIGN KEY (IDORDENCONTRACTUAL) REFERENCES ORDER_CONTRACTUAL
ALTER TABLE SALIDA_ALMACEN ADD FOREIGN KEY (IDFACTURA) REFERENCES FACTURA
ALTER TABLE COMPRA ADD FOREIGN KEY (IDINVENTARIO) REFERENCES INVENTARIO
 ALTER TABLE COMPRA ADD FOREIGN KEY (IDORDENCONTRACTUAL) REFERENCES ORDER_CONTRACTUAL
 ALTER TABLE COMPRA ADD FOREIGN KEY (IDSOLICITUD) REFERENCES SOLICITUDES
 ALTER TABLE SOLICITUDES ADD FOREIGN KEY (IDRESPONSBLE) REFERENCES USUARIOS 
 ALTER TABLE ITEMS ADD FOREIGN KEY (IDSOLICITUD) REFERENCES SOLICITUDES 
 go

/* USUARIOS*/
SELECT * FROM USUARIOS
GO


INSERT INTO USUARIOS VALUES ('Velasquez Cordova, Rony Javier','Administrador','72450897')
INSERT INTO USUARIOS VALUES ('Vergara García Milton Raúl','Administrador','75698236')
INSERT INTO USUARIOS VALUES ('Escobar Zavaleta, Gruber Omar ','Administrador','74589632')
INSERT INTO USUARIOS VALUES ('Diaz Cardenas, Brice Martin Sebastian','Administrador','79863254')
INSERT INTO USUARIOS VALUES ('Garcia Sedamano, Michael Enrique','Administrador','72460589')
GO
--PROCEDURES--
CREATE PROC PROC_INSERT_USERS(
@NOMBRE VARCHAR(60) ,
@ROL VARCHAR(20) ,
@CEDULA CHAR(10))
AS
 INSERT INTO USUARIOS(NOMBRE,ROL,CEDULA) VALUES (@NOMBRE,@ROL,@CEDULA)
GO
EXEC PROC_INSERT_USERS 'Ana','ADMIN','72450897'
GO
CREATE PROC COUNT_USERS
AS
SELECT COUNT(*) as NUMERO FROM USUARIOS
GO

CREATE PROC LIST_USERS
AS 
SELECT * FROM USUARIOS

GO
EXEC LIST_USERS
GO

/*SOLICITUDES*/
 select * from SOLICITUDES
 INSERT INTO SOLICITUDES VALUES (3,GETDATE()-579,'Planeamiento','Operacionales')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-598,'Ventas','Capital')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-432,'Ventas','Capital')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-932,'Ventas','Capital')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-502,'Gerencia de RRHH','Operacionales')
INSERT INTO SOLICITUDES VALUES (1,GETDATE()-1156,'Planeamiento','Operacionales')
INSERT INTO SOLICITUDES VALUES (3,GETDATE()-540,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (3,GETDATE()-1725,'Dirección General','Operacionales')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-1267,'Dirección General','Operacionales')
INSERT INTO SOLICITUDES VALUES (4,GETDATE()-1873,'Operaciones','Trasnferencias')
INSERT INTO SOLICITUDES VALUES (3,GETDATE()-1834,'Dirección General','Operacionales')
INSERT INTO SOLICITUDES VALUES (5,GETDATE()-1258,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (5,GETDATE()-1713,'Operaciones','Trasnferencias')
INSERT INTO SOLICITUDES VALUES (1,GETDATE()-1235,'Gerencia de RRHH','Operacionales')
INSERT INTO SOLICITUDES VALUES (4,GETDATE()-1734,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (1,GETDATE()-1985,'Planeamiento','Operacionales')
INSERT INTO SOLICITUDES VALUES (5,GETDATE()-570,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (3,GETDATE()-1929,'Gerencia de RRHH','Operacionales')
INSERT INTO SOLICITUDES VALUES (4,GETDATE()-539,'Gerencia de RRHH','Operacionales')
INSERT INTO SOLICITUDES VALUES (5,GETDATE()-1097,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (5,GETDATE()-1651,'Ventas','Capital')
INSERT INTO SOLICITUDES VALUES (2,GETDATE()-632,'Planeamiento','Operacionales')
INSERT INTO SOLICITUDES VALUES (1,GETDATE()-871,'Marketing','Capital')
INSERT INTO SOLICITUDES VALUES (1,GETDATE()-1774,'Gerencia de RRHH','Operacionales')
INSERT INTO SOLICITUDES VALUES (4,GETDATE()-810,'Ventas','Capital')
INSERT INTO SOLICITUDES VALUES (4,GETDATE()-970,'Planeamiento','Operacionales')
INSERT INTO SOLICITUDES VALUES (3,GETDATE()-1156,'Operaciones','Trasnferencias')

GO
ALTER TABLE SOLICITUDES ADD COL_STATUS BIT  NULL;
GO

UPDATE SOLICITUDES SET COL_STATUS=1 WHERE ID=2

--PROC SOLICITUDES--
CREATE PROC COUNT_SOLICITUDES
AS
SELECT COUNT(*) AS NUMERO FROM SOLICITUDES
GO

/*INVENTARIO*/

--PROC INVENTARIO--
CREATE PROC COUNT_INVENTARIO
AS 
SELECT COUNT(*)/(SELECT COUNT(*) FROM SALIDA_ALMACEN) AS NUMERO FROM INVENTARIO
GO
select * from INVENTARIO
GO
/*FACTURAS*/

--PROC FACTURAS--
CREATE PROC COUNT_FACT
AS
SELECT COUNT(*) AS NUMERO FROM FACTURA
GO
/*ITEMS*/
SELECT * FROM ITEMS

INSERT INTO ITEMS VALUES ('Computadoras',15,1400.5,21007.5,'Unidades',1,1)
INSERT INTO ITEMS VALUES ('Mouse',15,30,450,'Unidades',3,3)
INSERT INTO ITEMS VALUES ('Teclado',15,25,375,'Unidades',5,2)
INSERT INTO ITEMS VALUES ('Escritorios',5,150,750,'Unidades',27,2)
INSERT INTO ITEMS VALUES ('Teléfonos',2,600,1200,'Unidades',20,4)
INSERT INTO ITEMS VALUES ('Sillas',15,300,4500,'Unidades',5,3)
INSERT INTO ITEMS VALUES ('Impresoras',2,200,400,'Unidades',6,1)
INSERT INTO ITEMS VALUES ('Archivadores',25,1,25,'Unidades',18,1)
INSERT INTO ITEMS VALUES ('Plumones',30,5,150,'Unidades',15,2)
INSERT INTO ITEMS VALUES ('Hojas A4',1000,40,40000,'Paquetes',8,4)
INSERT INTO ITEMS VALUES ('Clips',1000,1,1000,'Unidades',6,3)
INSERT INTO ITEMS VALUES ('Perforadores',2,25,50,'Unidades',5,3)
INSERT INTO ITEMS VALUES ('Dispensadores',1,150,150,'Unidades',15,2)
INSERT INTO ITEMS VALUES ('Folders',300,2,600,'Unidades',8,2)
GO
--PROC ITEMS--


/*FACTURAS*/
SELECT * FROM FACTURA

--PROC FACTURAS--
GO
/*salida almacen*/

select * from SALIDA_ALMACEN
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-740,GETDATE()+745,1)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-961,GETDATE()+966,2)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-671,GETDATE()+676,1)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-198,GETDATE()+203,1)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-653,GETDATE()+658,2)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-634,GETDATE()+639,1)
INSERT INTO SALIDA_ALMACEN VALUES('Vergara García Milton Raúl',GETDATE()-661,GETDATE()+666,2)
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-256,GETDATE()+261,3)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-373,GETDATE()+378,1)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-869,GETDATE()+874,2)
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-166,GETDATE()+171,3)
INSERT INTO SALIDA_ALMACEN VALUES('Vergara García Milton Raúl',GETDATE()-124,GETDATE()+129,5)
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-440,GETDATE()+445,3)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-234,GETDATE()+239,6)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-688,GETDATE()+693,6)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-117,GETDATE()+122,7)
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-913,GETDATE()+918,7)
INSERT INTO SALIDA_ALMACEN VALUES('Vergara García Milton Raúl',GETDATE()-751,GETDATE()+756,5)
INSERT INTO SALIDA_ALMACEN VALUES('Velasquez Cordova, Rony Javier',GETDATE()-753,GETDATE()+758,5)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-478,GETDATE()+483,6)
INSERT INTO SALIDA_ALMACEN VALUES('Escobar Zavaleta, Gruber Omar ',GETDATE()-135,GETDATE()+140,7)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-212,GETDATE()+217,10)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-511,GETDATE()+516,8)
INSERT INTO SALIDA_ALMACEN VALUES('Diaz Cardenas, Brice Martin Sebastian',GETDATE()-774,GETDATE()+779,8)
GO

